<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>Nossa história</title>

    <link rel="manifest" href="/assets/pwa/manifest.json">
	  
	<!--<link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico">-->

	<link href='https://fonts.googleapis.com/css?family=Reenie+Beanie|Shantell+Sans|Kavoon' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="/assets/fontawesome/css/all.css">
    
    <link href="/assets/css/max/global.css" rel="stylesheet" type="text/css" />
    <link href="/assets/css/max/home.css" rel="stylesheet" type="text/css" />
    <script src="/assets/js/auth.js"></script>
</head>

<body>

    <div id="load">
        <img src="/assets/images/max/logo.png" alt="Logo">
    </div>

    <div id="blackout"></div>

    <div id="fundo"></div>

    <div id="main">
        <div id="header-menu">
            <div id="header-menu-fundo"></div>
            <div id="header-menu-logo">
                <img src="/assets/images/max/logo.png" alt="Logo" id="logo" onclick="logout()">
            </div>
            <div id="header-menu-buttons">
                <i class="fa-solid fa-magnifying-glass"></i>
                <i class="fa-solid fa-circle-plus" onclick="page_out('/max/editar_item.html')"></i>
            </div>
        </div>
        <!--<div class="carousel">
            <div class="carousel-track">
                <div class="carousel-slides">
                    <div class="carousel-slide"><img src="https://via.placeholder.com/600x900/FF5733/FFFFFF" alt="Slide 1"></div>
                    <div class="carousel-slide"><img src="https://via.placeholder.com/600x900/33FF57/FFFFFF" alt="Slide 2"></div>
                    <div class="carousel-slide"><img src="https://via.placeholder.com/600x900/3357FF/FFFFFF" alt="Slide 3"></div>
                </div>
                <div class="carousel-degrade bottom"></div>
            </div>
            <div id="carousel-footer">
                <div class="carousel-footer-bg"></div>
                <div class="carousel-indicators">
                    <div class="indicator active" data-index="0"></div>
                    <div class="indicator" data-index="1"></div>
                    <div class="indicator" data-index="2"></div>
                </div>
            </div>
        </div>-->
        <div id="conteudo">
            <div id="filtros">
                <div id="filtro-nenhum" class="filtro" onclick="filtrar('nenhum')" style="display: none;">
                    <p><i class="fa-solid fa-x"></i></p>
                </div>
                <div id="filtro-especial" class="filtro" onclick="filtrar('especial')">
                    <p>Histórias</p>
                </div>
                <div id="filtro-historia" class="filtro" onclick="filtrar('historia')">
                    <p>Recordações</p>
                </div>
                <div id="filtro-participantes" class="filtro" onclick="open_filtro_participantes()" participante="todos" style="display: none;">
                    <p>Todos os participantes <i class="fa-solid fa-chevron-down"></i></p>
                </div>
            </div>
            <div id="destaque">
                <div id="destaque-fundo">
                    <div id="destaque-cor"></div>
                    <div id="destaque-cor"></div>
                    <div id="destaque-imagem">
                        <img src="/assets/images/max/max.png" alt="Max">
                    </div>
                </div>
                <div id="destaque-info">
                    <div id="destaque-texto">
                        <p>Max</p>
                    </div>
                    <div id="destaque-botoes">
                        <div class="destaque-botao">
                            <i class="fa-solid fa-book-open-reader"></i>
                            <p>Ver história</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="secao">
                <div class="secao-titulo">
                    <p>Recomendados</p>
                </div>
                <div class="secao-conteudo" id="secao-recomendados"></div>
            </div>
            <div class="secao">
                <div class="secao-titulo">
                    <p>Melhores avaliados</p>
                </div>
                <div class="secao-conteudo" id="secao-melhores-avaliados"></div>
            </div>
            <div class="secao">
                <div class="secao-titulo">
                    <p>Últimos lançamentos</p>
                </div>
                <div class="secao-conteudo" id="secao-ultimos-lancamentos"></div>
            </div>
            <div class="secao">
                <div class="secao-titulo">
                    <p>Mais vistos</p>
                </div>
                <div class="secao-conteudo" id="secao-mais-vistos"></div>
            </div>
        </div>
    </div>

    <div id="select-filtro-participantes" style="display: none;">
        <div id="lista-participantes">
            <div class="participante ativo" participante="todos" onclick="filtrar('participante-todos')">
                <p>Todos os participantes</p>
            </div>
        </div>
        <div id="select-filtro-participantes-close-button" onclick="close_filtro_participantes()">
            <i class="fa-solid fa-x"></i>
        </div>
    </div>

    <script>

        if (document.readyState !== "complete")
            document.addEventListener("readystatechange", function() {
                if (document.readyState === "complete") {
                    onDOMLoaded();
                }
            });
        else 
            onDOMLoaded();

        let tipo_usuario;
        var promiseTipoUsario = verif_usuario();

        if (promiseTipoUsario !== undefined) {
            promiseTipoUsario.then((tipo) => {
                tipo_usuario = tipo;
                console.log('Tipo de usuário:', tipo_usuario);
            });
        }

        function setCookie(name, value) {
			document.cookie = name + "=" + value;
		}

        function getCookie(name) {
			const cookieValue = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
			return cookieValue ? cookieValue.pop() : '';
		}

        var api_headers = {};

        async function verify_token() {
            if (!document.cookie.split('; ').find(row => row.startsWith('gk='))) {
            setCookie("gk", "");
            } else {
            try {
                const response = await fetch(`https://api.github.com/user`, {
                headers: {
                    Authorization: `token ${getCookie("gk").split('$sep$')[0]}`
                }
                });

                if (response.ok) {
                console.log('Usuário autenticado:', response);
                const token = getCookie("gk").split('$sep$')[0];
                api_headers = {
                    Authorization: `Bearer ${token}`
                };
                } else {
                console.error('Erro ao autenticar usuário:', response.statusText);
                }
            } catch (error) {
                console.error('Erro ao autenticar usuário:', error);
            }
            }
        }

        (async () => {
            await verify_token();
        })();

        var urlParams = new URLSearchParams(window.location.search);
        var opt = urlParams.get('opt');

        var load = document.getElementById('load');
        var blackout = document.getElementById('blackout');
        var main = document.getElementById('main');

        if (opt === 'noload') {
            load.style.display = 'none';
            window.history.replaceState({}, document.title, window.location.pathname);
        } else {
            blackout.style.display = 'none';
            blackout.style.opacity = '0';
            load.style.display = 'flex';
            main.style.filter = 'blur(0px)';
        }

        if (localStorage.getItem('info_json') === null) {
            info_json = {itens_vistos: [], itens_avaliados: []};
            localStorage.setItem('info_json', JSON.stringify(info_json));
        } else {
            info_json = JSON.parse(localStorage.getItem('info_json'));
        }


        var tempoIniciado = Date.now();

        var conteudos = {}

        async function listar_conteudos() {
            async function listar_historias() {
                try {
                    let response = await fetch(`https://api.github.com/repos/YuriGomes4/Nuri/contents/assets/conteudo/historia.json?timestamp=${new Date().getTime()}`, { headers: api_headers });
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    let data = await response.json();
                    let historias_json = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                    for (let i = 0; i < Object.keys(historias_json).length; i++) {
                        var conteudo = historias_json[Object.keys(historias_json)[i]];
                        conteudo.tipo = 'historia';
                        conteudo.id = Object.keys(historias_json)[i];
                        try {
                            let response = await fetch(`http://144.22.227.71:7979/contador/${conteudo.id}?timestamp=${new Date().getTime()}`);
                            if (!response.ok) {
                                throw new Error('Network response was not ok ' + response.statusText);
                            }
                            let contador = await response.json();
                            conteudo.contador = contador;
                            //conteudos[conteudo.id] = conteudo;
                        } catch (error) {
                            if (!Object.keys(conteudo).includes('contador')) {
                                conteudo.contador = {"avaliacao_media": 0,"avaliacoes": 0,"visualizacoes": 0};
                                //conteudos[conteudo.id] = conteudo;
                            }
                        }
                        conteudos[conteudo.id] = conteudo;

                        historias_json[Object.keys(historias_json)[i]] = conteudo;
                    }

                    sessionStorage.setItem('historia', JSON.stringify(historias_json));
                } catch (error) {
                    try {
                        let response = await fetch(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/historia.json?timestamp=${new Date().getTime()}`);
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        let data = await response.json();
                        let historias_json = data;
                        for (let i = 0; i < Object.keys(historias_json).length; i++) {
                            var conteudo = historias_json[Object.keys(historias_json)[i]];
                            conteudo.tipo = 'historia';
                            conteudo.id = Object.keys(historias_json)[i];
                            try {
                                let response = await fetch(`http://144.22.227.71:7979/contador/${conteudo.id}?timestamp=${new Date().getTime()}`);
                                if (!response.ok) {
                                    throw new Error('Network response was not ok ' + response.statusText);
                                }
                                let contador = await response.json();
                                conteudo.contador = contador;
                                //conteudos[conteudo.id] = conteudo;
                            } catch (error) {
                                if (!Object.keys(conteudo).includes('contador')) {
                                    conteudo.contador = {"avaliacao_media": 0,"avaliacoes": 0,"visualizacoes": 0};
                                    //conteudos[conteudo.id] = conteudo;
                                }
                            }
                            conteudos[conteudo.id] = conteudo;

                            historias_json[Object.keys(historias_json)[i]] = conteudo;
                        }

                        sessionStorage.setItem('historia', JSON.stringify(historias_json));
                    } catch (error) {
                        console.error('There has been a problem with your fetch operation:', error);
                    }
                }
            }

            async function listar_especiais() {
                try {
                    let response = await fetch(`https://api.github.com/repos/YuriGomes4/Nuri/contents/assets/conteudo/especial.json?timestamp=${new Date().getTime()}`, { headers: api_headers });
                    if (!response.ok) {
                        throw new Error('Network response was not ok ' + response.statusText);
                    }
                    let data = await response.json();
                    let especiais_json = JSON.parse(decodeURIComponent(escape(atob(data.content))));
                    for (let i = 0; i < Object.keys(especiais_json).length; i++) {
                        var conteudo = especiais_json[Object.keys(especiais_json)[i]];
                        conteudo.tipo = 'especial';
                        conteudo.id = Object.keys(especiais_json)[i];
                        try {
                            let response = await fetch(`http://144.22.227.71:7979/contador/${conteudo.id}?timestamp=${new Date().getTime()}`);
                            if (!response.ok) {
                                throw new Error('Network response was not ok ' + response.statusText);
                            }
                            let contador = await response.json();
                            conteudo.contador = contador;
                            //conteudos[conteudo.id] = conteudo;
                        } catch (error) {
                            if (!Object.keys(conteudo).includes('contador')) {
                                conteudo.contador = {"avaliacao_media": 0,"avaliacoes": 0,"visualizacoes": 0};
                                //conteudos[conteudo.id] = conteudo;
                            }
                        }
                        conteudos[conteudo.id] = conteudo;

                        especiais_json[Object.keys(especiais_json)[i]] = conteudo;
                    }

                    sessionStorage.setItem('especial', JSON.stringify(especiais_json));
                } catch (error) {
                    try {
                        let response = await fetch(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/especial.json?timestamp=${new Date().getTime()}`);
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        let data = await response.json();
                        let especiais_json = data;
                        for (let i = 0; i < Object.keys(especiais_json).length; i++) {
                            var conteudo = especiais_json[Object.keys(especiais_json)[i]];
                            conteudo.tipo = 'especial';
                            conteudo.id = Object.keys(especiais_json)[i];
                            try {
                                let response = await fetch(`http://144.22.227.71:7979/contador/${conteudo.id}?timestamp=${new Date().getTime()}`);
                                if (!response.ok) {
                                    throw new Error('Network response was not ok ' + response.statusText);
                                }
                                let contador = await response.json();
                                conteudo.contador = contador;
                                //conteudos[conteudo.id] = conteudo;
                            } catch (error) {
                                if (!Object.keys(conteudo).includes('contador')) {
                                    conteudo.contador = {"avaliacao_media": 0,"avaliacoes": 0,"visualizacoes": 0};
                                    //conteudos[conteudo.id] = conteudo;
                                }
                            }
                            conteudos[conteudo.id] = conteudo;

                            especiais_json[Object.keys(especiais_json)[i]] = conteudo;
                        }

                        sessionStorage.setItem('especial', JSON.stringify(especiais_json));
                    } catch (error) {
                        console.error('There has been a problem with your fetch operation:', error);
                    }
                }
            }

            await listar_historias();
            await listar_especiais();

            /*async function atualizar_contador() {
                for (var i = 0; i < Object.keys(conteudos).length; i++) {
                    var conteudo = conteudos[Object.keys(conteudos)[i]];
                    
                    try {
                        let response = await fetch(`http://144.22.227.71:7979/contador/${conteudo.id}?timestamp=${new Date().getTime()}`);
                        if (!response.ok) {
                            throw new Error('Network response was not ok ' + response.statusText);
                        }
                        let contador = await response.json();
                        conteudo.contador = contador;
                        conteudos[conteudo.id] = conteudo;
                    } catch (error) {
                        if (!Object.keys(conteudo).includes('contador')) {
                            conteudo.contador = {"avaliacao_media": 0,"avaliacoes": 0,"visualizacoes": 0};
                            conteudos[conteudo.id] = conteudo;
                        }
                    }
                }

                sessionStorage.setItem('conteudo', JSON.stringify(conteudos));
            }

            await atualizar_contador();*/

            carregar_infos();
        }

        // Função para listar arquivos de um diretório do GitHub
        async function listarArquivosDoDiretorio(owner, repo) {
            
            try {
                const url = `https://api.github.com/repos/${owner}/${repo}/contents/assets/conteudo/historia?timestamp=${new Date().getTime()}`;
                const response = await fetch(url, {
                    headers: api_headers
                });

                if (!response.ok) {
                    throw new Error(`Erro ao acessar o diretório: ${response.statusText}`);
                }

                const data = await response.json();

                // Filtrando apenas os arquivos
                const arquivos = data
                    .filter(item => item.type === 'dir')
                    .map(dir => dir.name);

                
                for (var i = 0; i < arquivos.length; i++) {
                    //const response = await fetch(`/assets/conteudo/historia/${arquivos[i]}/main.json`);
                    /*const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/assets/conteudo/historia/${arquivos[i]}/main.json?timestamp=${new Date().getTime()}`, {
                        headers: api_headers
                    });*/
                    const response = await fetch(`https://raw.githubusercontent.com/${owner}/${repo}/main/assets/conteudo/historia/${arquivos[i]}/main.json?timestamp=${new Date().getTime()}`);

                    if (!response.ok) {
                        throw new Error(`Erro ao acessar o arquivo: ${response.statusText}`);
                    }

                    const json = await response.json();
                    json.id = arquivos[i];
                    json.tipo = 'historia';
                    historias[arquivos[i]] = json;
                }
            } catch (error) {
                console.error("Erro ao listar arquivos:", error);
            }

            try {
                const url = `https://api.github.com/repos/${owner}/${repo}/contents/assets/conteudo/especial`;
                const response = await fetch(url, {
                    headers: api_headers
                });

                if (!response.ok) {
                    throw new Error(`Erro ao acessar o diretório: ${response.statusText}`);
                }

                const data = await response.json();

                // Filtrando apenas os arquivos
                const arquivos = data
                    .filter(item => item.type === 'dir')
                    .map(dir => dir.name);

                
                for (var i = 0; i < arquivos.length; i++) {
                    //const response = await fetch(`/assets/conteudo/especial/${arquivos[i]}/main.json`);
                    /*const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/assets/conteudo/especial/${arquivos[i]}/main.json?timestamp=${new Date().getTime()}`, {
                        headers: api_headers
                    });*/
                    const response = await fetch(`https://raw.githubusercontent.com/${owner}/${repo}/main/assets/conteudo/especial/${arquivos[i]}/main.json?timestamp=${new Date().getTime()}`);

                    if (!response.ok) {
                        throw new Error(`Erro ao acessar o arquivo: ${response.statusText}`);
                    }

                    const json = await response.json();
                    json.id = arquivos[i];
                    json.tipo = 'especial';
                    especiais[arquivos[i]] = json;
                }
            } catch (error) {
                console.error("Erro ao listar arquivos:", error);
            }
        }

        async function fetchData() {
            try {
            const response = await fetch('/assets/conteudo/historia');
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const tbody = doc.querySelector('tbody');
            if (tbody) {
                const rows = Array.from(tbody.querySelectorAll('tr'));
                if (rows.length > 4) {
                    const filteredRows = rows.slice(3, -1);
                    const fetchPromises = filteredRows.map(async (row) => {
                        const secondTd = row.querySelectorAll('td')[1];
                        if (secondTd) {
                            var valor = secondTd.textContent;
                            console.log('Valor:', valor);
                            if (valor.includes('/')) {
                                const jsonResponse = await fetch('/assets/conteudo/historia/' + valor.split('/')[0] + '/main.json');
                                const json = await jsonResponse.json();
                                console.log('JSON de /assets/conteudo/historia/' + valor.split('/')[0] + '/main.json:', json);
                                json.id = valor.split('/')[0];
                                json.tipo = 'historia';
                                historias[valor.split('/')[0]] = json;
                            }
                        }
                    });
                    await Promise.all(fetchPromises);
                } else {
                    console.log('Menos de 5 linhas encontradas.');
                }
            } else {
                console.log('Nenhum tbody encontrado.');
            }
            console.log('Histórias:', historias);
            } catch (error) {
                console.error('Erro ao listar pastas:', error);
            }

            try {
            const response = await fetch('/assets/conteudo/especial');
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const tbody = doc.querySelector('tbody');
            if (tbody) {
                const rows = Array.from(tbody.querySelectorAll('tr'));
                if (rows.length > 4) {
                    const filteredRows = rows.slice(3, -1);
                    const fetchPromises = filteredRows.map(async (row) => {
                        const secondTd = row.querySelectorAll('td')[1];
                        if (secondTd) {
                            var valor = secondTd.textContent;
                            console.log('Valor:', valor);
                            if (valor.includes('/')) {
                                const jsonResponse = await fetch('/assets/conteudo/especial/' + valor.split('/')[0] + '/main.json');
                                const json = await jsonResponse.json();
                                console.log('JSON de /assets/conteudo/especial/' + valor.split('/')[0] + '/main.json:', json);
                                json.id = valor.split('/')[0];
                                json.tipo = 'especial';
                                especiais[valor.split('/')[0]] = json;
                            }
                        }
                    });
                    await Promise.all(fetchPromises);
                } else {
                    console.log('Menos de 5 linhas encontradas.');
                }
            } else {
                console.log('Nenhum tbody encontrado.');
            }
            console.log('Especiais:', especiais);
            } catch (error) {
                console.error('Erro ao listar pastas:', error);
            }
        }

        //listarArquivosDoDiretorio("YuriGomes4", "Nuri");

        function getDominantColor(imageObject) {
            var context = document.createElement("canvas").getContext("2d");

            // Ensure the image is loaded with crossOrigin attribute set to "Anonymous"
            if (!imageObject.crossOrigin) {
                imageObject.crossOrigin = "Anonymous";
            }

            //desenha a imagem para um pixel e deixe o navegador encontrar a cor dominante
            context.drawImage(imageObject, 0, 0, 1, 1);

            //obter cor de pixel
            const i = context.getImageData(0, 0, 1, 1).data;

            const dominantColor = `rgba(${i[0]},${i[1]},${i[2]},${i[3]})`;
            console.log(dominantColor);

            const hexColor = "#" + ((1 << 24) + (i[0] << 16) + (i[1] << 8) + i[2]).toString(16).slice(1);
            console.log(hexColor);

            document.documentElement.style.setProperty('--cor-principal', dominantColor);
        }

        window.addEventListener('scroll', function() {
            var fundo = document.getElementById('fundo');
            var scrollPosition = window.scrollY;
            var windowHeight = window.innerHeight;
            var maxScroll = windowHeight * 0.75;

            if (scrollPosition <= maxScroll) {
                var opacity = 1 - (scrollPosition / maxScroll);
                fundo.style.opacity = opacity;
            } else {
                fundo.style.opacity = 0;
            }
        });

        var imagens_capa = []
        var outras_imagens = []

        function carregar_infos() {
            var imagem_destaque = document.getElementById('destaque-imagem').querySelector('img');
            var titulo_destaque = document.getElementById('destaque-texto').querySelector('p');
            var destaque_texto = document.getElementById('destaque-texto');
            var destaque_botao = document.getElementById('destaque-botoes').querySelector('.destaque-botao');
            var texto_btnverhistoria = destaque_botao.querySelector('p');
            var lista_participantes = document.getElementById('lista-participantes');

            console.log('Conteúdos:', conteudos);

            var destaque = conteudos[Object.keys(conteudos)[0]];

            for (var i = 0; i < Object.keys(conteudos).length; i++) {
                var conteudo = conteudos[Object.keys(conteudos)[i]];

                if (conteudo.data > destaque.data) {
                    destaque = conteudo;
                }
            }
        
            console.log('Destaque:', destaque);

            //imagem_destaque.src = "/assets/conteudo/"+ destaque.tipo +"/" + destaque.id + "/fotos/" + destaque.capa;
            if (destaque.capa.includes('imgur')) {
                imagem_destaque.src = destaque.capa;
            } else {
                imagem_destaque.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${destaque.tipo}/${destaque.id}/fotos/${destaque.capa}`;
            }
            imagem_destaque.addEventListener('load', function() {
                getDominantColor(this);
            });
            titulo_destaque.textContent = destaque.nome;
            destaque_texto.onclick = function() {
                //window.location.href = '/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id;
                page_out('/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id);
            };

            if(destaque.tipo === 'historia') {
                texto_btnverhistoria.textContent = 'Ver recordação';
            } else if(destaque.tipo === 'especial') {
                texto_btnverhistoria.textContent = 'Ver história';
            }

            destaque_botao.onclick = function() {
                //window.location.href = '/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id;
                page_out('/max/apresentacao/stories.html?tipo=' + destaque.tipo + '&id=' + destaque.id);
            };

            participantes = [];

            maior_qnt_avaliacao = 0;
            maior_avalicao_media = 5;

            for (var i = 0; i < Object.keys(conteudos).length; i++) {
                var conteudo = conteudos[Object.keys(conteudos)[i]];

                if (conteudo.contador.avaliacoes > maior_qnt_avaliacao) {
                    maior_qnt_avaliacao = conteudo.contador.avaliacoes;
                }

                for (var j = 0; j < conteudo.participantes.length; j++) {
                    if (!participantes.includes(conteudo.participantes[j])) {
                        participantes.push(conteudo.participantes[j]);
                    }
                }

                for (var j = 0; j < conteudo.partes.length; j++) {
                    //outras_imagens.push("/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.fotos[j]);
                    if (conteudo.partes[j].imagem.includes('imgur')) {
                        outras_imagens.push(conteudo.partes[j].imagem);
                    } else {
                        outras_imagens.push(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.partes[j].imagem}`);
                    }
                }
            }

            if (maior_qnt_avaliacao > 0) {
                for (var i = 0; i < Object.keys(conteudos).length; i++) {
                    var conteudo = conteudos[Object.keys(conteudos)[i]];

                    if (conteudo.contador.avaliacoes > 0) {
                        pontuacao_qnt_avalicoes = (conteudo.contador.avaliacoes / maior_qnt_avaliacao) * 50;
                        pontuacao_avalicao_media = (conteudo.contador.avaliacao_media / maior_avalicao_media) * 100;

                        pontuacao = pontuacao_qnt_avalicoes + pontuacao_avalicao_media;

                        conteudo.pontuacao = pontuacao;
                    } else {
                        conteudo.pontuacao = 0;
                    }
                }

                var conteudosArray = Object.values(conteudos);
                conteudosArray.sort((a, b) => b.pontuacao - a.pontuacao);
                var conteudos_melhores_avaliados = [];
                conteudosArray.forEach(conteudo => {
                    if (conteudos_melhores_avaliados.length < 10 && conteudo.contador.avaliacoes > 0) {
                        conteudos_melhores_avaliados.push(conteudo);
                    }
                });
            }

            var conteudosArray = Object.values(conteudos);
            conteudosArray.sort((a, b) => b.contador.visualizacoes - a.contador.visualizacoes);
            var conteudos_mais_vistos = [];
            conteudosArray.forEach(conteudo => {
                if (conteudos_mais_vistos.length < 10) {
                    conteudos_mais_vistos.push(conteudo);
                }
            });

            var conteudosArray = Object.values(conteudos);
            conteudosArray.sort((a, b) => new Date(b.data) - new Date(a.data));
            var conteudos_ultimos_lancamentos = [];
            conteudosArray.forEach(conteudo => {
                if (conteudos_ultimos_lancamentos.length < 10) {
                    conteudos_ultimos_lancamentos.push(conteudo);
                }
            });


            if (tipo_usuario === "" || tipo_usuario === undefined) {
                promiseTipoUsario.then((tipo) => {
                    tipo_usuario = tipo;

                    //carregar_recomendados(conteudos);
                    if (maior_qnt_avaliacao > 0) {
                        carregar_melhores_avaliados(conteudos_melhores_avaliados);
                    }
                    carregar_ultimos_lancamentos(conteudos_ultimos_lancamentos);
                    carregar_mais_vistos(conteudos_mais_vistos);
                });
            } else {
                //carregar_recomendados(conteudos);
                if (maior_qnt_avaliacao > 0) {
                    carregar_melhores_avaliados(conteudos_melhores_avaliados);
                }
                carregar_ultimos_lancamentos(conteudos_ultimos_lancamentos);
                carregar_mais_vistos(conteudos_mais_vistos);
            }

            function carregar_recomendados(conteudos_recomendados) {
                console.log('Conteúdos recomendados:', conteudos_recomendados);
                var secao_recomendados = document.getElementById('secao-recomendados');

                for (var i = 0; i < Object.keys(conteudos_recomendados).length; i++) {
                    var conteudo = conteudos_recomendados[Object.keys(conteudos_recomendados)[i]];

                    controle = true;


                    if (conteudo.exclusivo && tipo_usuario !== "dono") {
                        controle = false;
                    }


                    if (controle) {

                        //imagens_capa.push("/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa);
                        if (conteudo.capa.includes('imgur')) {
                            imagens_capa.push(conteudo.capa);
                        } else {
                            imagens_capa.push(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`);
                        }

                        var div = document.createElement('div');
                        div.className = 'secao-item';
                        div.setAttribute('item-id', conteudo.id);
                        div.setAttribute('item-tipo', conteudo.tipo);
                        div.setAttribute('item-uid', conteudo.id);
                        div.onclick = function() {
                            page_out('/max/item.html?tipo='+ this.getAttribute('item-tipo') +'&id=' + this.getAttribute('item-id'));
                        };

                        var img = document.createElement('img');
                        //img.src = "/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa;
                        if (conteudo.capa.includes('imgur')) {
                            img.src = conteudo.capa;
                        } else {
                            img.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`;
                        }

                        var p = document.createElement('p');
                        p.textContent = conteudo.nome;

                        div.appendChild(img);
                        div.appendChild(p);

                        secao_recomendados.appendChild(div);

                    }
                }

                if (Object.keys(conteudos_recomendados).length > 0) {
                    secao_recomendados.parentElement.style.display = 'block';
                } else {
                    secao_recomendados.parentElement.style.display = 'none';
                }
            }

            function carregar_melhores_avaliados(conteudos_melhores_avaliados) {
                console.log('Conteúdos melhores avaliados:', conteudos_melhores_avaliados);
                var secao_melhores_avaliados = document.getElementById('secao-melhores-avaliados');

                for (var i = 0; i < conteudos_melhores_avaliados.length; i++) {
                    var conteudo = conteudos_melhores_avaliados[i];

                    controle = true;


                    if (conteudo.exclusivo && tipo_usuario !== "dono") {
                        controle = false;
                    }


                    if (controle) {

                        //imagens_capa.push("/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa);
                        if (conteudo.capa.includes('imgur')) {
                            imagens_capa.push(conteudo.capa);
                        } else {
                            imagens_capa.push(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`);
                        }

                        var div = document.createElement('div');
                        div.className = 'secao-item';
                        div.setAttribute('item-id', conteudo.id);
                        div.setAttribute('item-tipo', conteudo.tipo);
                        div.setAttribute('item-uid', conteudo.id);
                        div.onclick = function() {
                            page_out('/max/item.html?tipo='+ this.getAttribute('item-tipo') +'&id=' + this.getAttribute('item-id'));
                        };

                        var img = document.createElement('img');
                        //img.src = "/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa;
                        if (conteudo.capa.includes('imgur')) {
                            img.src = conteudo.capa;
                        } else {
                            img.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`;
                        }

                        var p = document.createElement('p');
                        p.textContent = conteudo.nome;

                        div.appendChild(img);
                        div.appendChild(p);

                        secao_melhores_avaliados.appendChild(div);

                    }
                }

                if (conteudos_melhores_avaliados.length > 0) {
                    secao_melhores_avaliados.parentElement.style.display = 'block';
                } else {
                    secao_melhores_avaliados.parentElement.style.display = 'none';
                }
            }

            function carregar_ultimos_lancamentos(conteudos_ultimos_lancamentos) {
                console.log('Conteúdos últimos lançamentos:', conteudos_ultimos_lancamentos);
                var secao_ultimos_lancamentos = document.getElementById('secao-ultimos-lancamentos');

                for (var i = 0; i < conteudos_ultimos_lancamentos.length; i++) {
                    var conteudo = conteudos_ultimos_lancamentos[i];

                    controle = true;


                    if (conteudo.exclusivo && tipo_usuario !== "dono") {
                        controle = false;
                    }


                    if (controle) {

                        //imagens_capa.push("/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa);
                        if (conteudo.capa.includes('imgur')) {
                            imagens_capa.push(conteudo.capa);
                        } else {
                            imagens_capa.push(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`);
                        }

                        var div = document.createElement('div');
                        div.className = 'secao-item';
                        div.setAttribute('item-id', conteudo.id);
                        div.setAttribute('item-tipo', conteudo.tipo);
                        div.setAttribute('item-uid', conteudo.id);
                        div.onclick = function() {
                            page_out('/max/item.html?tipo='+ this.getAttribute('item-tipo') +'&id=' + this.getAttribute('item-id'));
                        };

                        var img = document.createElement('img');
                        //img.src = "/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa;
                        if (conteudo.capa.includes('imgur')) {
                            img.src = conteudo.capa;
                        } else {
                            img.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`;
                        }

                        var p = document.createElement('p');
                        p.textContent = conteudo.nome;

                        div.appendChild(img);
                        div.appendChild(p);

                        secao_ultimos_lancamentos.appendChild(div);

                    }
                }

                if (conteudos_ultimos_lancamentos.length > 0) {
                    secao_ultimos_lancamentos.parentElement.style.display = 'block';
                } else {
                    secao_ultimos_lancamentos.parentElement.style.display = 'none';
                }
            }

            function carregar_mais_vistos(conteudos_mais_vistos) {
                console.log('Conteúdos mais vistos:', conteudos_mais_vistos);
                var secao_mais_vistos = document.getElementById('secao-mais-vistos');

                for (var i = 0; i < conteudos_mais_vistos.length; i++) {
                    var conteudo = conteudos_mais_vistos[i];

                    controle = true;


                    if (conteudo.exclusivo && tipo_usuario !== "dono") {
                        controle = false;
                    }


                    if (controle) {

                        //imagens_capa.push("/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa);
                        if (conteudo.capa.includes('imgur')) {
                            imagens_capa.push(conteudo.capa);
                        } else {
                            imagens_capa.push(`https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`);
                        }

                        var div = document.createElement('div');
                        div.className = 'secao-item';
                        div.setAttribute('item-id', conteudo.id);
                        div.setAttribute('item-tipo', conteudo.tipo);
                        div.setAttribute('item-uid', conteudo.id);
                        div.onclick = function() {
                            page_out('/max/item.html?tipo='+ this.getAttribute('item-tipo') +'&id=' + this.getAttribute('item-id'));
                        };

                        var img = document.createElement('img');
                        //img.src = "/assets/conteudo/historia/" + Object.keys(historias)[i] + "/fotos/" + historia.capa;
                        if (conteudo.capa.includes('imgur')) {
                            img.src = conteudo.capa;
                        } else {
                            img.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${conteudo.tipo}/${conteudo.id}/fotos/${conteudo.capa}`;
                        }

                        var p = document.createElement('p');
                        p.textContent = conteudo.nome;

                        div.appendChild(img);
                        div.appendChild(p);

                        secao_mais_vistos.appendChild(div);

                    }
                }

                if (conteudos_mais_vistos.length > 0) {
                    secao_mais_vistos.parentElement.style.display = 'block';
                } else {
                    secao_mais_vistos.parentElement.style.display = 'none';
                }
            }



            participantes.sort();

            for (var i = 0; i < participantes.length; i++) {
                var div = document.createElement('div');
                div.className = 'participante';
                div.setAttribute('participante', participantes[i]);
                div.onclick = function() {
                    filtrar("participante-" + this.getAttribute('participante'));
                };

                var p = document.createElement('p');
                p.textContent = participantes[i];

                div.appendChild(p);

                lista_participantes.appendChild(div);
            }
        }

        filtrados_tipo = [];
        filtrados_participante = [];

        function filtrar(filtro) {
            var imagem_destaque = document.getElementById('destaque-imagem').querySelector('img');
            var titulo_destaque = document.getElementById('destaque-texto').querySelector('p');
            var destaque_texto = document.getElementById('destaque-texto');
            var destaque_botao = document.getElementById('destaque-botoes').querySelector('.destaque-botao');
            var texto_btnverhistoria = destaque_botao.querySelector('p');
            var secao_recomendados = document.getElementById('secao-recomendados');

            var filtro_nenhum = document.getElementById('filtro-nenhum');
            var filtro_especial = document.getElementById('filtro-especial');
            var filtro_historia = document.getElementById('filtro-historia');
            var filtro_participantes = document.getElementById('filtro-participantes');

            var div_conteudos = document.getElementsByClassName('secao-item');

            var destaque = {};

            if (filtro === "nenhum") {

                filtrados_tipo = [];
                filtrados_participante = [];

                for (var i = 0; i < div_conteudos.length; i++) {
                    var div = div_conteudos[i];
                    var conteudo = conteudos[div.getAttribute('item-uid')];
                    var tipo = div.getAttribute('item-tipo');

                    //div.style.display = 'flex';
                    filtrados_tipo.push(div);
                    filtrados_participante.push(div);
                }

                filtro_nenhum.style.display = 'none';
                filtro_especial.style.display = 'flex';
                filtro_especial.classList.remove('ativo');
                filtro_historia.style.display = 'flex';
                filtro_historia.classList.remove('ativo');
                filtro_participantes.style.display = 'none';


            } else if (filtro === "especial") {

                filtrados_tipo = [];
                filtrados_participante = [];

                for (var i = 0; i < div_conteudos.length; i++) {
                    var div = div_conteudos[i];
                    var conteudo = conteudos[div.getAttribute('item-uid')];
                    var tipo = div.getAttribute('item-tipo');

                    if (tipo === 'especial') {
                        //div.style.display = 'flex';
                        filtrados_tipo.push(div);
                        filtrados_participante.push(div);
                    }
                }

                filtro_nenhum.style.display = 'flex';
                filtro_historia.style.display = 'none';
                filtro_historia.classList.remove('ativo');
                filtro_participantes.style.display = 'flex';
                filtro_especial.classList.add('ativo');
            } else if (filtro === "historia") {

                filtrados_tipo = [];
                filtrados_participante = [];

                for (var i = 0; i < div_conteudos.length; i++) {
                    var div = div_conteudos[i];
                    var conteudo = conteudos[div.getAttribute('item-uid')];
                    var tipo = div.getAttribute('item-tipo');

                    if (tipo === 'historia') {
                        //div.style.display = 'flex';
                        filtrados_tipo.push(div);
                        filtrados_participante.push(div);
                    }
                }

                filtro_nenhum.style.display = 'flex';
                filtro_especial.style.display = 'none';
                filtro_especial.classList.remove('ativo');
                filtro_participantes.style.display = 'flex';
                filtro_historia.classList.add('ativo');
            } else if (filtro.includes("participante-")) {

                var participante = filtro.split("-")[1];

                filtrados_participante = [];

                for (var i = 0; i < div_conteudos.length; i++) {
                    var div = div_conteudos[i];
                    var conteudo = conteudos[div.getAttribute('item-uid')];
                    var tipo = div.getAttribute('item-tipo');

                    if (conteudo.participantes.includes(participante)) {
                        //div.style.display = 'flex';
                        filtrados_participante.push(div);
                    } else if (participante === "todos") {
                        //div.style.display = 'flex';
                        filtrados_participante.push(div);
                    }
                }

                filtro_participantes.setAttribute('participante', participante);
                if (participante === "todos") {
                    filtro_participantes.querySelector('p').innerHTML = "Todos os participantes <i class='fa-solid fa-chevron-down'></i>";
                } else {
                    filtro_participantes.querySelector('p').innerHTML = participante + " <i class='fa-solid fa-chevron-down'></i>";
                }

                close_filtro_participantes();
            }

            try {
                
                filtro_final = filtrados_tipo.filter(item => filtrados_participante.includes(item));

                for (var i = 0; i < div_conteudos.length; i++) {
                    var div = div_conteudos[i];
                    var conteudo = conteudos[div.getAttribute('item-uid')];
                    
                    if (filtro_final.includes(div)) {
                        div.style.display = 'flex';

                        if (Object.keys(destaque).length > 0) {
                            if (conteudo.data > destaque.data) {
                                destaque = conteudo;
                            }
                        } else {
                            destaque = conteudo;
                        }
                    } else {
                        div.style.display = 'none';
                    }
                }

                if (Object.keys(destaque).length > 0) {
                    if (destaque.capa.includes('imgur')) {
                        imagem_destaque.src = destaque.capa;
                    } else {
                        imagem_destaque.src = `https://raw.githubusercontent.com/YuriGomes4/Nuri/main/assets/conteudo/${destaque.tipo}/${destaque.id}/fotos/${destaque.capa}`;
                    }
                    titulo_destaque.textContent = destaque.nome;
                    destaque_texto.onclick = function() {
                        //window.location.href = '/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id;
                        page_out('/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id);
                    };

                    if(destaque.tipo === 'historia') {
                        texto_btnverhistoria.textContent = 'Ver recordação';
                    } else if(destaque.tipo === 'especial') {
                        texto_btnverhistoria.textContent = 'Ver história';
                    }

                    destaque_botao.onclick = function() {
                        //window.location.href = '/max/item.html?tipo=' + destaque.tipo + '&id=' + destaque.id;
                        page_out('/max/apresentacao/stories.html?tipo=' + destaque.tipo + '&id=' + destaque.id);
                    };
                }

                var secao_recomendados = document.getElementById('secao-recomendados');
                var secao_melhores_avaliados = document.getElementById('secao-melhores-avaliados');
                var secao_ultimos_lancamentos = document.getElementById('secao-ultimos-lancamentos');
                var secao_mais_vistos = document.getElementById('secao-mais-vistos');

                var divs_secao_recomendados = secao_recomendados.getElementsByClassName('secao-item');
                var divs_secao_melhores_avaliados = secao_melhores_avaliados.getElementsByClassName('secao-item');
                var divs_secao_ultimos_lancamentos = secao_ultimos_lancamentos.getElementsByClassName('secao-item');
                var divs_secao_mais_vistos = secao_mais_vistos.getElementsByClassName('secao-item');

                var secao_recomendados_visivel = false;
                var secao_melhores_avaliados_visivel = false;
                var secao_ultimos_lancamentos_visivel = false;
                var secao_mais_vistos_visivel = false;

                for (var i = 0; i < divs_secao_recomendados.length; i++) {
                    var div = divs_secao_recomendados[i];

                    if (filtro_final.includes(div)) {
                        secao_recomendados_visivel = true;
                        secao_recomendados_visivel = true;
                        break;
                    }
                }

                for (var i = 0; i < divs_secao_melhores_avaliados.length; i++) {
                    var div = divs_secao_melhores_avaliados[i];

                    if (filtro_final.includes(div)) {
                        secao_melhores_avaliados_visivel = true;
                        secao_melhores_avaliados_visivel = true;
                        break;
                    }
                }

                for (var i = 0; i < divs_secao_ultimos_lancamentos.length; i++) {
                    var div = divs_secao_ultimos_lancamentos[i];

                    if (filtro_final.includes(div)) {
                        secao_ultimos_lancamentos_visivel = true;
                        secao_ultimos_lancamentos_visivel = true;
                        break;
                    }
                }

                for (var i = 0; i < divs_secao_mais_vistos.length; i++) {
                    var div = divs_secao_mais_vistos[i];

                    if (filtro_final.includes(div)) {
                        secao_mais_vistos_visivel = true;
                        secao_mais_vistos_visivel = true;
                        break;
                    }
                }

                if (secao_recomendados_visivel) {
                    secao_recomendados.parentElement.style.display = 'block';
                } else {
                    secao_recomendados.parentElement.style.display = 'none';
                }

                if (secao_melhores_avaliados_visivel) {
                    secao_melhores_avaliados.parentElement.style.display = 'block';
                } else {
                    secao_melhores_avaliados.parentElement.style.display = 'none';
                }

                if (secao_ultimos_lancamentos_visivel) {
                    secao_ultimos_lancamentos.parentElement.style.display = 'block';
                } else {
                    secao_ultimos_lancamentos.parentElement.style.display = 'none';
                }

                if (secao_mais_vistos_visivel) {
                    secao_mais_vistos.parentElement.style.display = 'block';
                } else {
                    secao_mais_vistos.parentElement.style.display = 'none';
                }

            } catch (error) {
                console.error('Erro ao filtrar:', error);
            }
        }

        function open_filtro_participantes() {
            var filtro_participantes = document.getElementById('filtro-participantes');
            participante = filtro_participantes.getAttribute('participante');
            var lista_participantes = document.getElementById('lista-participantes');
            var participantes = lista_participantes.getElementsByClassName('participante');

            for (var i = 0; i < participantes.length; i++) {
                if (participantes[i].getAttribute('participante') === participante) {
                    participantes[i].classList.add('ativo');
                } else {
                    participantes[i].classList.remove('ativo');
                }
            }

            var select_filtro_participantes = document.getElementById('select-filtro-participantes');
            select_filtro_participantes.style.display = 'flex';
            select_filtro_participantes.style.transition = 'opacity 0.5s ease';
            select_filtro_participantes.offsetHeight;
            select_filtro_participantes.style.opacity = '1';
        }

        function close_filtro_participantes() {
            var select_filtro_participantes = document.getElementById('select-filtro-participantes');
            select_filtro_participantes.style.transition = 'opacity 0.5s ease';
            select_filtro_participantes.offsetHeight;
            select_filtro_participantes.style.opacity = '0';
            setTimeout(() => {
                select_filtro_participantes.style.display = 'none';
            }, 500);
        }

        /*const url = window.location.href;
        if (url.includes("localhost") || url.includes("192.168")) {
        //if (url.includes("192.168")) {
            fetchData().then(() => {
                carregar_infos();
            });
        } else {
            listarArquivosDoDiretorio("YuriGomes4", "Nuri").then(() => {
                carregar_infos();
            });
        }*/

        listar_conteudos();

        function logout() {
            setCookie("gk", "");
            document.cookie.split(";").forEach(function(c) { 
                document.cookie = c.trim().startsWith("c=") ? "c=;expires=Thu, 01 Jan 1970 00:00:00 UTC;path=/" : c; 
            });
            window.location.href = "/";
        }

        function page_out (link) {
            var blackout = document.getElementById('blackout');
            var main = document.getElementById('main');

            blackout.style.display = 'block';
            blackout.style.transition = 'opacity 0.5s ease';
            blackout.offsetHeight;
            blackout.style.opacity = '1';

            //main.style.transition = 'filter 1s ease';
            main.style.filter = 'blur(100px)';

            const urlParams = new URLSearchParams(window.location.search);
            urlParams.set('opt', 'noload');
            window.history.replaceState({}, '', `${window.location.pathname}?${urlParams}`);

            setTimeout(() => {
                window.location.href = link;
                page_in();
            }, 500);

        }

        function page_in () {
            var blackout = document.getElementById('blackout');
            var main = document.getElementById('main');

            //main.style.transition = 'filter 1s ease';
            main.style.filter = 'blur(0px)';

            //blackout.style.transition = 'none';
            //blackout.style.opacity = 1;
            blackout.style.display = 'block';
            blackout.style.transition = 'opacity 1.5s ease';
            blackout.offsetHeight;
            blackout.style.opacity = 0;
        }

        Promise.all(imagens_capa.map(src => {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.src = src;
                img.onload = resolve;
                img.onerror = reject;
            });
        })).then(() => {
            onDOMLoaded();
            carregar_outras_imagens();
        }).catch(error => {
            console.error('Erro ao carregar imagens:', error);
        });

        function carregar_outras_imagens() {
            console.log('Carregando outras imagens:', outras_imagens);
            outras_imagens.forEach(src => {
                if (src.includes('.mp4')) {
                    const video = document.createElement('video');
                    video.src = src;
                    video.autoplay = false;
                    video.loop = false;
                    video.muted = true;
                    video.style.display = 'none';
                    document.body.appendChild(video);
                } else {
                    const img = new Image();
                    img.src = src;
                    img.onload = () => {
                        console.log(`Imagem carregada: ${src}`);
                    };
                    img.onerror = () => {
                        console.error(`Erro ao carregar imagem: ${src}`);
                    };
                }
            });
        }

        /*if (document.readyState !== "complete")
            document.addEventListener("load", onDOMLoaded);
        else 
            onDOMLoaded();*/

        var controle = 0;

        function onDOMLoaded() {
            controle++;
            if (controle === 2) {

                if (opt === 'noload') {

                    setTimeout(() => {
                        page_in();
                    }, 500);

                } else {

                    setTimeout(() => {
                        var tempoFinal = Date.now();
                        var tempoTotal = tempoFinal - tempoIniciado;

                        var load = document.getElementById('load');
                        var imgLoad = load.querySelector('img');

                        console.log(imgLoad);

                        imgLoad.style.transition = 'transform 1s cubic-bezier(0.99, 0.03, 0.92, 0.25)';
                        imgLoad.offsetHeight;
                        imgLoad.style.transform = 'scale(10)';

                        load.style.transition = 'opacity 1s cubic-bezier(0.99, 0.03, 0.92, 0.25)';
                        load.style.opacity = '0';

                        setTimeout(() => {
                            load.style.display = 'none';
                        }, 1000);
                    }, 1000);
                }
            }
        };

      </script>

</body>

</html>